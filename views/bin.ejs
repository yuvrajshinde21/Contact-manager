<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recycle Bin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        #message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4bb543;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: block;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4">Recycle Bin</h2>

        <!-- Table for deleted items -->
        <form method="POST" action="/contact/bin/action" onsubmit="return confirm('Are you sure?')">
            <table class="table table-bordered">
                <thead>

                    <%if(contacts && contacts.length> 0){%>

                        <tr>
                            <th><input type="checkbox" id="selectAll"></th>
                            <th>Name</th>
                            <th>Deleted On</th>
                        </tr>
                </thead>
                <tbody>
                    <%contacts.forEach((contact,i)=>{%>
                        <tr>
                            <td>
                                <input type="checkbox" name="selectedId" class="select" value="<%=contact.id%>" />
                                <input type="hidden" name="email" value="<%=contact.email%>" />
                                <input type="hidden" name="phone" value="<%=contact.phone%>" />
                            </td>
                            <td>
                                <%=contact.first_name%>
                                    <%=contact.last_name%>
                            </td>
                            <td>
                                <%=contact.updated_at.toLocaleString()%>
                            </td>
                        </tr>
                        <% })%>
                </tbody>
                <%}else{%>
                    <tr>
                        <th colspan="3">Bin is Empty</th>
                    </tr>
                    <%}%>
            </table>

            <!-- Buttons -->
            <button type="submit" name="action" value="restore" class="btn btn-success">Restore Selected</button>
            <button type="submit" name="action" value="delete" class="btn btn-danger">Delete Selected</button>
        </form>
    </div>
    <%if(message){%>
        <div id="message">
            <%= message %>
        </div>
        <%}%>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const selectAll = document.getElementById("selectAll");

                    if (selectAll) {
                        selectAll.addEventListener("change", function () {
                            const checkboxes = document.querySelectorAll(".select");
                            checkboxes.forEach(e => e.checked = this.checked)
                        })
                    }
                })

                document.addEventListener("DOMContentLoaded", function () {
                    const message1 = document.getElementById(("message"));
                    if (message1) {
                        setTimeout(() => {
                            message1.remove();
                        }, 3000)
                    }
                })
            </script>
</body>

</html>